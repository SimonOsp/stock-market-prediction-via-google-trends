<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>

    <!-- Initialize a select button -->
    <select id="selectButton"></select>

    <!-- Create a div where the graph will take place -->
    <div id="my_dataviz"></div>

    <!-- Color Scale -->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700;900&display=swap" rel="stylesheet">

    <style>
      #my_dataviz {
        margin: 0 auto;
        width: 50%;
      }
    </style>
</head>

<body>
    <script>

        // set the dimensions and margins of the graph
        var margin = {top: 100, right: 100, bottom: 100, left: 100},
            width = 800 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;
        
        // append the svg object to the body of the page
        var svg = d3.select("#my_dataviz")
          .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // gridlines in y axis function
        function make_y_gridlines(y) {		
          return d3.axisLeft(y)
            .ticks(4)
            .tickValues([0.25, 0.50, 0.75, 1.0])
        }
        
        //Read the data
        d3.csv("data/data.csv", function(data) {
        
          // List of groups (here I have one group per column)
          var allGroup = ["debt", "color", "stocks", "restaurant", "portfolio", "inflation", "housing","dow jones", "revenue",
                          "economics", "credit", "markets", "return", "unemployment", "money", "religion", "cancer", "growth", 
                          "investment", "hedge", "marriage", "bonds", "derivatives", "headlines", "profit", "society", "leverage", 
                          "loss", "cash", "office", "fine", "stock market", "banking", "crisis", "happy", "car", "nasdaq", 
                          "gains", "finance", "sell", "invest", "fed", "house", "metals", "travel", "returns", "gain", 
                          "default", "present", "holiday", "water", "rich", "risk", "gold", "success", "oil", "war", "economy", 
                          "chance", "lifestyle", "greed", "food", "movie", "nyse", "ore", "opportunity", "health", "earnings", 
                          "arts", "culture", "bubble", "buy", "trader", "tourism", "politics", "energy", "consume", "consumption",
                          "freedom", "dividend", "world", "conflict", "kitchen", "forex", "home", "cash", "transaction", "garden",
                          "fond", "train", "labor", "fun", "environment", "ring"]
      
          // add the options to the button
          d3.select("#selectButton")
            .selectAll('myOptions')
                .data(allGroup)
            .enter()
              .append('option')
            .text(function (d) { return d; }) // text showed in the menu
            .attr("value", function (d) { return d; }) // corresponding value returned by the button
      
          // A color scale: one color for each group
          var myColor = d3.scaleOrdinal()
            .domain(allGroup)
            .range(d3.schemeSet2);
      
          // Add X axis --> it is a date format
          var parseTime = d3.timeParse("%Y-%m-%d")

          var dates = [];

          for (let obj of data) {
            dates.push(parseTime(obj.Date));
          }

          var x = d3.scaleTime()
            .domain(d3.extent(dates))
            .range([0, width]);

          svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .style("font-size", "12px")
            .style("font-family", "Roboto, sans-serif")
            .call(d3.axisBottom(x));

          // Add Y axis
          var y = d3.scaleLinear()
            .domain([0, 1])
            .range([height, 100]);

          var y1 = d3.scaleLinear()
            .domain([0, 55000])
            .range([height, 100]);

          // add the Y gridlines
          svg.append("g")			
            .attr("stroke-dasharray", "5, 5")
            .attr("opacity", ".4")
            .call(make_y_gridlines(y)
              .tickSize(-width)
              .tickFormat("")
            )
            .call(g => g.select(".domain").remove());
          
          // text label for the y axis
          var yText = svg
            .append("text")             
              .attr("transform", "rotate(-90)")
              .attr("y", 0 - 40)
              .attr("x",0 - (height / 2) - 140)
              .attr("dy", "1em")
              .style("font-family", "Roboto, sans-serif")
              .style("font-size", "14px")
              .style("letter-spacing", ".005em")
              .style("fill", function(d) { return myColor("debt") })
              .text("AMOUNT OF SEARCHES →");  

            // text label for the y1 axis
          var y1Text = svg
            .append("text")             
              .attr("transform", "rotate(-90)")
              .attr("y", width + 20)
              .attr("x",0 - (height / 2) - 140)
              .attr("dy", "1em")
              .style("font-family", "Roboto, sans-serif")
              .style("font-size", "14px")
              .style("letter-spacing", ".005em")
              .text("DJIA STOCK PRICE →"); 

          // text label for the title
          svg.append("text")
            .attr("x", 0)             
            .attr("y", 0 - (margin.top / 2) + 80) 
            .style("font-family", "Roboto, sans-serif")
            .style("font-size", "24px")
            .text("DAILY DATA");
          
          // text label for the title
          var title = svg
            .append("text")
              .attr("x", 134)             
              .attr("y", 0 - (margin.top / 2) + 80) 
              .style("font-family", "Roboto, sans-serif")
              .style("font-size", "24px")
              .style("fill", function(d) { return myColor("debt") })
              .text('"debt"');
      
          // Initialize line with group a
          var line = svg
            .append('g')
            .append("path")
              .datum(data)
              .attr("d", d3.line()
                .x(function(d) { return x(+parseTime(d.Date)) })
                .y(function(d) { return y(+d.debt) })
              )
              .attr("stroke", function(d){ return myColor("debt") })
              .style("stroke-width", 1)
              .style("fill", "none");
          
          const line2 = svg
            .append("g")
            .append("path")
              .datum(data)
              .attr("d", d3.line()
                .x(function(d) { return x(+parseTime(d.Date)) })
                .y(function(d) { return y1(+d.Close) })
              )
              .attr("stroke", "black")
              .style("stroke-width", 1)
              .style("fill", "none");
          
          var mouseG = svg.append("g")
            .attr("class", "mouse-over-effects");

          mouseG.append("path") // this is the black vertical line to follow mouse
            .attr("class", "mouse-line")
            .style("stroke", "black")
            .style("stroke-width", "2px")
            .style("opacity", "0");

          mouseG.append('svg:rect') // append a rect to catch mouse movements on canvas
            .attr('width', width) // can't catch mouse events on a g element
            .attr('height', height)
            .attr('fill', 'none')
            .attr('pointer-events', 'all')
            .on('mouseout', function() { // on mouse out hide line, circles and text
              d3.select(".mouse-line")
                .style("opacity", "0");
            })
            .on('mouseover', function() { // on mouse in show line, circles and text
              d3.select(".mouse-line")
                .style("opacity", "1");
            })
            .on('mousemove', function() { // mouse moving over canvas
              var mouse = d3.mouse(this);
              d3.select(".mouse-line")
                .attr("d", function() {
                  var d = "M" + mouse[0] + "," + height;
                  d += " " + mouse[0] + "," + 100;
                  return d;
                });
            });
      
          // A function that update the chart
          function update(selectedGroup) {
      
            // Create new data with the selection
            var dataFilter = data.map(function(d){return {index: d.Date, value:d[selectedGroup]} })

            const animationDuration = 1000;
      
            // Give these new data to update line
            line
              .datum(dataFilter)
              .transition()
              .duration(animationDuration)
                .attr("d", d3.line()
                  .x(function(d) { return x(+parseTime(d.index)) })
                  .y(function(d) { return y(+d.value) })
                )
                .attr("stroke", function(d){ return myColor(selectedGroup) });
            
            title
              .transition()
              .duration(animationDuration)
                .style("fill", function(d){ return myColor(selectedGroup) })
                .text('"' + selectedGroup + '"');

            yText
              .transition()
              .duration(animationDuration)
                .style("fill", function(d){ return myColor(selectedGroup) });
          }
      
          // When the button is changed, run the updateChart function
          d3.select("#selectButton").on("change", function(d) {
              // recover the option that has been chosen
              var selectedOption = d3.select(this).property("value")
              // run the updateChart function with this selected option
              update(selectedOption)
          })
        
        })
        
        
        </script>
</body>

</html>